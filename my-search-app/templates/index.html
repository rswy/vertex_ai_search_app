<!DOCTYPE html>
<html>
<head>
    <title>Vertex AI Widget (JWT Secured)</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cloud.google.com/ai/gen-app-builder/client?hl=en_US"></script>
</head>
<body>
    <h2>Vertex AI Search Widget (JWT Secured)</h2>

    <gen-search-widget
      configId="6491b2ed-bc2f-4186-ba55-2c73421f7e45"
      triggerId="searchWidgetTrigger">
    </gen-search-widget>

    <input placeholder="Search here" id="searchWidgetTrigger" />

    <script>
      async function setAuthToken() {
        const res = await fetch("/token");
        const data = await res.json();
        const searchWidget = document.querySelector('gen-search-widget');
        searchWidget.authToken = data.token;
      }

      // Set token immediately when page loads
      setAuthToken();

      // Refresh every 55 minutes (token expires in 60 min)
      setInterval(setAuthToken, 55 * 60 * 1000);
    </script>

</body>
</html>